Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=function(){return(t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function n(e,t,r,n){return new(r||(r=Promise))(function(i,o){function u(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(u,a)}c((n=n.apply(e,t||[])).next())})}function i(e,t){var r,n,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var o=Object.prototype.hasOwnProperty;var u=new WeakMap,a=0;var c=function(){function e(e){void 0===e&&(e={}),this.cache=new Map(Object.entries(e)),this.subs=[]}return e.prototype.get=function(e){var t=this.serializeKey(e)[0];return this.cache.get(t)},e.prototype.set=function(e,t){var r=this.serializeKey(e)[0];this.cache.set(r,t),this.notify()},e.prototype.keys=function(){return Array.from(this.cache.keys())},e.prototype.has=function(e){var t=this.serializeKey(e)[0];return this.cache.has(t)},e.prototype.clear=function(){this.cache.clear(),this.notify()},e.prototype.delete=function(e){var t=this.serializeKey(e)[0];this.cache.delete(t),this.notify()},e.prototype.serializeKey=function(e){var t=null;if("function"==typeof e)try{e=e()}catch(t){e=""}return Array.isArray(e)?(t=e,e=function(e){if(!e.length)return"";for(var t="arg",r=0;r<e.length;++r)if(null!==e[r]){var n=void 0;"object"!=typeof e[r]&&"function"!=typeof e[r]?n="string"==typeof e[r]?'"'+e[r]+'"':String(e[r]):u.has(e[r])?n=u.get(e[r]):(n=a,u.set(e[r],a++)),t+="@"+n}else t+="@null";return t}(e)):e=String(e||""),[e,t,e?"err@"+e:"",e?"validating@"+e:""]},e.prototype.subscribe=function(e){var t=this;if("function"!=typeof e)throw new Error("Expected the listener to be a function.");var r=!0;return this.subs.push(e),function(){if(r){r=!1;var n=t.subs.indexOf(e);n>-1&&(t.subs[n]=t.subs[t.subs.length-1],t.subs.length--)}}},e.prototype.notify=function(){for(var e=0,t=this.subs;e<t.length;e++){(0,t[e])()}},e}(),s=!0,f={isOnline:function(){return s},isDocumentVisible:function(){return"undefined"==typeof document||void 0===document.visibilityState||"hidden"!==document.visibilityState},fetcher:function(e){return fetch(e).then(function(e){return e.json()})},registerOnFocus:function(e){"undefined"!=typeof window&&void 0!==window.addEventListener&&"undefined"!=typeof document&&void 0!==document.addEventListener&&(document.addEventListener("visibilitychange",function(){return e()},!1),window.addEventListener("focus",function(){return e()},!1))},registerOnReconnect:function(e){"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",function(){s=!0,e()},!1),window.addEventListener("offline",function(){return s=!1},!1))}},l=new c;var d="undefined"!=typeof window&&navigator.connection&&-1!==["slow-2g","2g"].indexOf(navigator.connection.effectiveType),v=t({onLoadingSlow:function(){},onSuccess:function(){},onError:function(){},onErrorRetry:function(e,t,r,n,i){if(r.isDocumentVisible()&&!("number"==typeof r.errorRetryCount&&i.retryCount>r.errorRetryCount)){var o=Math.min(i.retryCount,8),u=~~((Math.random()+.5)*(1<<o))*r.errorRetryInterval;setTimeout(n,u,i)}},errorRetryInterval:1e3*(d?10:5),focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:1e3*(d?5:3),refreshInterval:0,revalidateOnFocus:!0,revalidateOnReconnect:!0,refreshWhenHidden:!1,refreshWhenOffline:!1,shouldRetryOnError:!0,suspense:!1,compare:function e(t,r){var n,i;if(t===r)return!0;if(t&&r&&(n=t.constructor)===r.constructor){if(n===Date)return t.getTime()===r.getTime();if(n===RegExp)return t.toString()===r.toString();if(n===Array){if((i=t.length)===r.length)for(;i--&&e(t[i],r[i]););return-1===i}if(!n||"object"==typeof t){for(n in i=0,t){if(o.call(t,n)&&++i&&!o.call(r,n))return!1;if(!(n in r)||!e(t[n],r[n]))return!1}return Object.keys(r).length===i}}return t!=t&&r!=r},isPaused:function(){return!1}},f),h="undefined"==typeof window||!!("undefined"!=typeof Deno&&Deno&&Deno.version&&Deno.version.deno),p=h?null:window.requestAnimationFrame?function(e){return window.requestAnimationFrame(e)}:function(e){return setTimeout(e,1)},y=h?e.useEffect:e.useLayoutEffect,g=e.createContext({});function b(t,r){var n=e.useState({})[1],i=e.useRef(t);y(function(){i.current=t});var o=e.useRef({data:!1,error:!1,isValidating:!1}),u=e.useCallback(function(e){for(var t=!1,u=0,a=Object.keys(e);u<a.length;u++){var c=a[u];i.current[c]!==e[c]&&(i.current[c]=e[c],o.current[c]&&(t=!0))}t&&!r.current&&n({})},[]);return[i,o,u]}function m(t){var r=Object.assign({},v,e.useContext(g),t.length>2?t[2]:2===t.length&&"object"==typeof t[1]?t[1]:{}),n=t.length>2||2===t.length&&"function"==typeof t[1]||null===t[1]?t[1]:r.fetcher;return[t[0],r,n]}g.displayName="SWRConfigContext";var w,O={},R={},S={},x={},E={},j={},P={},C=(w=0,function(){return++w});if(!h){var V=function(e){if(v.isDocumentVisible()&&v.isOnline())for(var t in e)e[t][0]&&e[t][0]()};"function"==typeof v.registerOnFocus&&v.registerOnFocus(function(){return V(S)}),"function"==typeof v.registerOnReconnect&&v.registerOnReconnect(function(){return V(x)})}var T=function(e,t){void 0===t&&(t=!0);var r=l.serializeKey(e),n=r[0],i=r[2],o=r[3];if(!n)return Promise.resolve();var u=E[n];if(n&&u){for(var a=l.get(n),c=l.get(i),s=l.get(o),f=[],d=0;d<u.length;++d)f.push(u[d](t,a,c,s,d>0));return Promise.all(f).then(function(){return l.get(n)})}return Promise.resolve(l.get(n))},k=function(e,t,r,n){var i=E[e];if(e&&i)for(var o=0;o<i.length;++o)i[o](!1,t,r,n)};function z(e,t,r){return void 0===r&&(r=!0),n(this,void 0,void 0,function(){var n,o,u,a,c,s,f,d,v,h,p,y;return i(this,function(i){switch(i.label){case 0:if(n=l.serializeKey(e),o=n[0],u=n[2],!o)return[2,void 0];if(void 0===t)return[2,T(e,r)];if(j[o]=C()-1,P[o]=0,a=j[o],f=!1,"function"==typeof t)try{t=t(l.get(o))}catch(e){t=void 0,s=e}if(!t||"function"!=typeof t.then)return[3,5];f=!0,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t];case 2:return c=i.sent(),[3,4];case 3:return d=i.sent(),s=d,[3,4];case 4:return[3,6];case 5:c=t,i.label=6;case 6:if((v=function(){if(a!==j[o]){if(s)throw s;return!0}})())return[2,c];if(void 0!==c&&l.set(o,c),l.set(u,s),P[o]=C()-1,!f&&v())return[2,c];if(h=E[o]){for(p=[],y=0;y<h.length;++y)p.push(h[y](!!r,c,s,void 0,y>0));return[2,Promise.all(p).then(function(){if(s)throw s;return l.get(o)})]}if(s)throw s;return[2,c]}})})}var I=function(e,t,r){return e[t]?e[t].push(r):e[t]=[r],function(){var n=e[t],i=n.indexOf(r);i>=0&&(n[i]=n[n.length-1],n.pop())}};function D(){for(var r=this,o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];var a=m(o),c=a[0],s=a[1],f=a[2],d=l.serializeKey(c),v=d[0],g=d[1],w=d[2],V=d[3],T=e.useRef(s);y(function(){T.current=s});var D=e.useRef(!1),K=e.useRef(!1),L=e.useRef(v),W=function(){var e=l.get(v);return void 0===e?s.initialData:e},A=W(),F=l.get(w),M=function(){return void 0!==s.revalidateOnMount?s.revalidateOnMount:s.suspense?!D.current&&void 0!==A:void 0===s.initialData},q=function(){return!!v&&(!!l.get(V)||!D.current&&M())},H=q(),_=e.useCallback(function(e){K.current||v===L.current&&D.current&&e()},[v]),G=b({data:A,error:F,isValidating:H},K),N=G[0],B=G[1],J=G[2],Q=e.useCallback(function(e){return void 0===e&&(e={}),n(r,void 0,void 0,function(){var t,r,n,o,u,a,c,d,h,p;return i(this,function(i){switch(i.label){case 0:if(!v||!f)return[2,!1];if(K.current)return[2,!1];if(T.current.isPaused())return[2,!1];t=e.retryCount,r=void 0===t?0:t,n=e.dedupe,o=void 0!==n&&n,u=!0,a=void 0!==O[v]&&o,i.label=1;case 1:return i.trys.push([1,6,,7]),l.set(V,!0),J({isValidating:!0}),a||k(v,N.current.data,N.current.error,!0),a?(d=R[v],[4,O[v]]):[3,3];case 2:return c=i.sent(),[3,5];case 3:return s.loadingTimeout&&!l.get(v)&&setTimeout(function(){u&&_(function(){return T.current.onLoadingSlow(v,s)})},s.loadingTimeout),O[v]=null!==g?f.apply(void 0,g):f(v),R[v]=d=C(),[4,O[v]];case 4:c=i.sent(),setTimeout(function(){R[v]===d&&(delete O[v],delete R[v])},s.dedupingInterval),_(function(){return T.current.onSuccess(c,v,s)}),i.label=5;case 5:return R[v]!==d?[2,!1]:void 0!==j[v]&&(d<=j[v]||d<=P[v]||0===P[v])?(J({isValidating:!1}),[2,!1]):(l.set(w,void 0),l.set(V,!1),h={isValidating:!1},void 0!==N.current.error&&(h.error=void 0),s.compare(N.current.data,c)||(h.data=c),s.compare(l.get(v),c)||l.set(v,c),J(h),a||k(v,c,h.error,!1),[3,7]);case 6:return p=i.sent(),delete O[v],delete R[v],T.current.isPaused()?(J({isValidating:!1}),[2,!1]):(l.set(w,p),N.current.error!==p&&(J({isValidating:!1,error:p}),a||k(v,void 0,p,!1)),_(function(){return T.current.onError(p,v,s)}),s.shouldRetryOnError&&_(function(){return T.current.onErrorRetry(p,v,s,Q,{retryCount:r+1,dedupe:!0})}),[3,7]);case 7:return u=!1,[2,!0]}})})},[v]);if(y(function(){if(v){var e=D.current;K.current=!1,L.current=v,e&&J({data:A,error:F,isValidating:H});var r=function(){return Q({dedupe:!0})};(e||M())&&(void 0===A||h?r():p(r));var n=!1,i=I(S,v,function(){!n&&T.current.revalidateOnFocus&&(n=!0,r(),setTimeout(function(){return n=!1},T.current.focusThrottleInterval))}),o=I(x,v,function(){T.current.revalidateOnReconnect&&r()}),u=I(E,v,function(e,n,i,o,u){return void 0===e&&(e=!0),void 0===u&&(u=!0),J(t({error:i,isValidating:o},s.compare(n,N.current.data)?null:{data:n})),!!e&&(u?r:Q)()});return D.current=!0,function(){K.current=!0,i(),o(),u()}}},[v,Q]),y(function(){var e=null,t=function(){return n(r,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return N.current.error||!T.current.refreshWhenHidden&&!T.current.isDocumentVisible()||!T.current.refreshWhenOffline&&!T.current.isOnline()?[3,2]:[4,Q({dedupe:!0})];case 1:r.sent(),r.label=2;case 2:return T.current.refreshInterval&&e&&(e=setTimeout(t,T.current.refreshInterval)),[2]}})})};return T.current.refreshInterval&&(e=setTimeout(t,T.current.refreshInterval)),function(){e&&(clearTimeout(e),e=null)}},[s.refreshInterval,s.refreshWhenHidden,s.refreshWhenOffline,Q]),s.suspense&&void 0===A){if(void 0===F)throw Q({dedupe:!0});throw F}var U=e.useCallback(function(e,t){return z(L.current,e,t)},[]),X={revalidate:Q,mutate:U};return Object.defineProperties(X,{data:{get:function(){return B.current.data=!0,A},enumerable:!0},error:{get:function(){return B.current.error=!0,F},enumerable:!0},isValidating:{get:function(){return B.current.isValidating=!0,H},enumerable:!0}}),e.useDebugValue(A),X}Object.defineProperty(g.Provider,"default",{value:v});var K=g.Provider;exports.SWRConfig=K,exports.cache=l,exports.default=D,exports.mutate=z,exports.trigger=T,exports.useSWRInfinite=function(){for(var t=this,o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];var a=m(o),c=a[0],s=a[1],f=a[2],d=s.initialSize,v=void 0===d?1:d,h=s.revalidateAll,p=void 0!==h&&h,g=s.persistSize,b=void 0!==g&&g,w=r(s,["initialSize","revalidateAll","persistSize"]),O=null;try{O=l.serializeKey(c?c(0,null):null)[0]}catch(e){}var R=e.useState({})[1],S=null;O&&(S="ctx@"+O);var x=null;O&&(x="len@"+O);var E=e.useRef(!1),j=e.useCallback(function(){var e=l.get(x);return void 0!==e?e:v},[x,v]),P=e.useRef(j());y(function(){E.current?O&&l.set(x,b?P.current:v):E.current=!0},[O]);var C=e.useRef(),V=D(O?["inf",O]:null,function(){return n(t,void 0,void 0,function(){var e,t,r,n,o,u,a,d,v,h,y,g;return i(this,function(i){switch(i.label){case 0:e=l.get(S)||{},t=e.data,r=e.force,n=[],o=j(),u=null,a=0,i.label=1;case 1:return a<o?(d=l.serializeKey(c?c(a,u):null),v=d[0],h=d[1],v?(y=l.get(v),g=p||r||void 0===y||void 0===r&&0===a&&void 0!==C.current||t&&!s.compare(t[a],y),f&&g?null===h?[3,3]:[4,f.apply(void 0,h)]:[3,6]):[3,8]):[3,8];case 2:return y=i.sent(),[3,5];case 3:return[4,f(v)];case 4:y=i.sent(),i.label=5;case 5:l.set(v,y),i.label=6;case 6:n.push(y),u=y,i.label=7;case 7:return++a,[3,1];case 8:return l.delete(S),[2,n]}})})},w);y(function(){C.current=V.data},[V.data]);var T=e.useCallback(function(e,t){if(void 0===t&&(t=!0),S){if(t&&void 0!==e){var r=C.current;l.set(S,{data:r,force:!1})}else t&&l.set(S,{force:!0});return V.mutate(e,t)}},[S]),k=e.useCallback(function(e){var t;if(x)return"function"==typeof e?t=e(j()):"number"==typeof e&&(t=e),"number"==typeof t&&(l.set(x,t),P.current=t),R({}),T(function(e){return e})},[x,j,T,R]),z={size:j(),setSize:k,mutate:T};return Object.defineProperties(z,{error:{get:function(){return V.error},enumerable:!0},data:{get:function(){return V.data},enumerable:!0},revalidate:{get:function(){return V.revalidate},enumerable:!0},isValidating:{get:function(){return V.isValidating},enumerable:!0}}),z};
