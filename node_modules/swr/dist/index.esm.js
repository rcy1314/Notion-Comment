import{useEffect as e,useLayoutEffect as r,createContext as t,useState as n,useRef as i,useCallback as o,useContext as u,useDebugValue as a}from"react";var c=function(){return(c=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e}).apply(this,arguments)};function s(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)r.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(t[n[i]]=e[n[i]])}return t}function f(e,r,t,n){return new(t||(t=Promise))(function(i,o){function u(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new t(function(r){r(e.value)}).then(u,a)}c((n=n.apply(e,r||[])).next())})}function l(e,r){var t,n,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=r.call(e,u)}catch(e){o=[6,e],n=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var d=Object.prototype.hasOwnProperty;var v=new WeakMap,h=0;var p=function(){function e(e){void 0===e&&(e={}),this.cache=new Map(Object.entries(e)),this.subs=[]}return e.prototype.get=function(e){var r=this.serializeKey(e)[0];return this.cache.get(r)},e.prototype.set=function(e,r){var t=this.serializeKey(e)[0];this.cache.set(t,r),this.notify()},e.prototype.keys=function(){return Array.from(this.cache.keys())},e.prototype.has=function(e){var r=this.serializeKey(e)[0];return this.cache.has(r)},e.prototype.clear=function(){this.cache.clear(),this.notify()},e.prototype.delete=function(e){var r=this.serializeKey(e)[0];this.cache.delete(r),this.notify()},e.prototype.serializeKey=function(e){var r=null;if("function"==typeof e)try{e=e()}catch(r){e=""}return Array.isArray(e)?(r=e,e=function(e){if(!e.length)return"";for(var r="arg",t=0;t<e.length;++t)if(null!==e[t]){var n=void 0;"object"!=typeof e[t]&&"function"!=typeof e[t]?n="string"==typeof e[t]?'"'+e[t]+'"':String(e[t]):v.has(e[t])?n=v.get(e[t]):(n=h,v.set(e[t],h++)),r+="@"+n}else r+="@null";return r}(e)):e=String(e||""),[e,r,e?"err@"+e:"",e?"validating@"+e:""]},e.prototype.subscribe=function(e){var r=this;if("function"!=typeof e)throw new Error("Expected the listener to be a function.");var t=!0;return this.subs.push(e),function(){if(t){t=!1;var n=r.subs.indexOf(e);n>-1&&(r.subs[n]=r.subs[r.subs.length-1],r.subs.length--)}}},e.prototype.notify=function(){for(var e=0,r=this.subs;e<r.length;e++){(0,r[e])()}},e}(),y=!0,g={isOnline:function(){return y},isDocumentVisible:function(){return"undefined"==typeof document||void 0===document.visibilityState||"hidden"!==document.visibilityState},fetcher:function(e){return fetch(e).then(function(e){return e.json()})},registerOnFocus:function(e){"undefined"!=typeof window&&void 0!==window.addEventListener&&"undefined"!=typeof document&&void 0!==document.addEventListener&&(document.addEventListener("visibilitychange",function(){return e()},!1),window.addEventListener("focus",function(){return e()},!1))},registerOnReconnect:function(e){"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",function(){y=!0,e()},!1),window.addEventListener("offline",function(){return y=!1},!1))}},b=new p;var m="undefined"!=typeof window&&navigator.connection&&-1!==["slow-2g","2g"].indexOf(navigator.connection.effectiveType),w=c({onLoadingSlow:function(){},onSuccess:function(){},onError:function(){},onErrorRetry:function(e,r,t,n,i){if(t.isDocumentVisible()&&!("number"==typeof t.errorRetryCount&&i.retryCount>t.errorRetryCount)){var o=Math.min(i.retryCount,8),u=~~((Math.random()+.5)*(1<<o))*t.errorRetryInterval;setTimeout(n,u,i)}},errorRetryInterval:1e3*(m?10:5),focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:1e3*(m?5:3),refreshInterval:0,revalidateOnFocus:!0,revalidateOnReconnect:!0,refreshWhenHidden:!1,refreshWhenOffline:!1,shouldRetryOnError:!0,suspense:!1,compare:function e(r,t){var n,i;if(r===t)return!0;if(r&&t&&(n=r.constructor)===t.constructor){if(n===Date)return r.getTime()===t.getTime();if(n===RegExp)return r.toString()===t.toString();if(n===Array){if((i=r.length)===t.length)for(;i--&&e(r[i],t[i]););return-1===i}if(!n||"object"==typeof r){for(n in i=0,r){if(d.call(r,n)&&++i&&!d.call(t,n))return!1;if(!(n in t)||!e(r[n],t[n]))return!1}return Object.keys(t).length===i}}return r!=r&&t!=t},isPaused:function(){return!1}},g),O="undefined"==typeof window||!!("undefined"!=typeof Deno&&Deno&&Deno.version&&Deno.version.deno),S=O?null:window.requestAnimationFrame?function(e){return window.requestAnimationFrame(e)}:function(e){return setTimeout(e,1)},j=O?e:r,E=t({});function P(e,r){var t=n({})[1],u=i(e);j(function(){u.current=e});var a=i({data:!1,error:!1,isValidating:!1}),c=o(function(e){for(var n=!1,i=0,o=Object.keys(e);i<o.length;i++){var c=o[i];u.current[c]!==e[c]&&(u.current[c]=e[c],a.current[c]&&(n=!0))}n&&!r.current&&t({})},[]);return[u,a,c]}function T(e){var r=Object.assign({},w,u(E),e.length>2?e[2]:2===e.length&&"object"==typeof e[1]?e[1]:{}),t=e.length>2||2===e.length&&"function"==typeof e[1]||null===e[1]?e[1]:r.fetcher;return[e[0],r,t]}E.displayName="SWRConfigContext";var V,x={},z={},R={},I={},D={},K={},k={},L=(V=0,function(){return++V});if(!O){var A=function(e){if(w.isDocumentVisible()&&w.isOnline())for(var r in e)e[r][0]&&e[r][0]()};"function"==typeof w.registerOnFocus&&w.registerOnFocus(function(){return A(R)}),"function"==typeof w.registerOnReconnect&&w.registerOnReconnect(function(){return A(I)})}var C=function(e,r){void 0===r&&(r=!0);var t=b.serializeKey(e),n=t[0],i=t[2],o=t[3];if(!n)return Promise.resolve();var u=D[n];if(n&&u){for(var a=b.get(n),c=b.get(i),s=b.get(o),f=[],l=0;l<u.length;++l)f.push(u[l](r,a,c,s,l>0));return Promise.all(f).then(function(){return b.get(n)})}return Promise.resolve(b.get(n))},W=function(e,r,t,n){var i=D[e];if(e&&i)for(var o=0;o<i.length;++o)i[o](!1,r,t,n)};function F(e,r,t){return void 0===t&&(t=!0),f(this,void 0,void 0,function(){var n,i,o,u,a,c,s,f,d,v,h,p;return l(this,function(l){switch(l.label){case 0:if(n=b.serializeKey(e),i=n[0],o=n[2],!i)return[2,void 0];if(void 0===r)return[2,C(e,t)];if(K[i]=L()-1,k[i]=0,u=K[i],s=!1,"function"==typeof r)try{r=r(b.get(i))}catch(e){r=void 0,c=e}if(!r||"function"!=typeof r.then)return[3,5];s=!0,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,r];case 2:return a=l.sent(),[3,4];case 3:return f=l.sent(),c=f,[3,4];case 4:return[3,6];case 5:a=r,l.label=6;case 6:if((d=function(){if(u!==K[i]){if(c)throw c;return!0}})())return[2,a];if(void 0!==a&&b.set(i,a),b.set(o,c),k[i]=L()-1,!s&&d())return[2,a];if(v=D[i]){for(h=[],p=0;p<v.length;++p)h.push(v[p](!!t,a,c,void 0,p>0));return[2,Promise.all(h).then(function(){if(c)throw c;return b.get(i)})]}if(c)throw c;return[2,a]}})})}var M=function(e,r,t){return e[r]?e[r].push(t):e[r]=[t],function(){var n=e[r],i=n.indexOf(t);i>=0&&(n[i]=n[n.length-1],n.pop())}};function H(){for(var e=this,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var n=T(r),u=n[0],s=n[1],d=n[2],v=b.serializeKey(u),h=v[0],p=v[1],y=v[2],g=v[3],m=i(s);j(function(){m.current=s});var w=i(!1),E=i(!1),V=i(h),A=function(){var e=b.get(h);return void 0===e?s.initialData:e},C=A(),H=b.get(y),q=function(){return void 0!==s.revalidateOnMount?s.revalidateOnMount:s.suspense?!w.current&&void 0!==C:void 0===s.initialData},G=function(){return!!h&&(!!b.get(g)||!w.current&&q())},N=G(),B=o(function(e){E.current||h===V.current&&w.current&&e()},[h]),J=P({data:C,error:H,isValidating:N},E),Q=J[0],U=J[1],X=J[2],Y=o(function(r){return void 0===r&&(r={}),f(e,void 0,void 0,function(){var e,t,n,i,o,u,a,c,f,v;return l(this,function(l){switch(l.label){case 0:if(!h||!d)return[2,!1];if(E.current)return[2,!1];if(m.current.isPaused())return[2,!1];e=r.retryCount,t=void 0===e?0:e,n=r.dedupe,i=void 0!==n&&n,o=!0,u=void 0!==x[h]&&i,l.label=1;case 1:return l.trys.push([1,6,,7]),b.set(g,!0),X({isValidating:!0}),u||W(h,Q.current.data,Q.current.error,!0),u?(c=z[h],[4,x[h]]):[3,3];case 2:return a=l.sent(),[3,5];case 3:return s.loadingTimeout&&!b.get(h)&&setTimeout(function(){o&&B(function(){return m.current.onLoadingSlow(h,s)})},s.loadingTimeout),x[h]=null!==p?d.apply(void 0,p):d(h),z[h]=c=L(),[4,x[h]];case 4:a=l.sent(),setTimeout(function(){z[h]===c&&(delete x[h],delete z[h])},s.dedupingInterval),B(function(){return m.current.onSuccess(a,h,s)}),l.label=5;case 5:return z[h]!==c?[2,!1]:void 0!==K[h]&&(c<=K[h]||c<=k[h]||0===k[h])?(X({isValidating:!1}),[2,!1]):(b.set(y,void 0),b.set(g,!1),f={isValidating:!1},void 0!==Q.current.error&&(f.error=void 0),s.compare(Q.current.data,a)||(f.data=a),s.compare(b.get(h),a)||b.set(h,a),X(f),u||W(h,a,f.error,!1),[3,7]);case 6:return v=l.sent(),delete x[h],delete z[h],m.current.isPaused()?(X({isValidating:!1}),[2,!1]):(b.set(y,v),Q.current.error!==v&&(X({isValidating:!1,error:v}),u||W(h,void 0,v,!1)),B(function(){return m.current.onError(v,h,s)}),s.shouldRetryOnError&&B(function(){return m.current.onErrorRetry(v,h,s,Y,{retryCount:t+1,dedupe:!0})}),[3,7]);case 7:return o=!1,[2,!0]}})})},[h]);if(j(function(){if(h){var e=w.current;E.current=!1,V.current=h,e&&X({data:C,error:H,isValidating:N});var r=function(){return Y({dedupe:!0})};(e||q())&&(void 0===C||O?r():S(r));var t=!1,n=M(R,h,function(){!t&&m.current.revalidateOnFocus&&(t=!0,r(),setTimeout(function(){return t=!1},m.current.focusThrottleInterval))}),i=M(I,h,function(){m.current.revalidateOnReconnect&&r()}),o=M(D,h,function(e,t,n,i,o){return void 0===e&&(e=!0),void 0===o&&(o=!0),X(c({error:n,isValidating:i},s.compare(t,Q.current.data)?null:{data:t})),!!e&&(o?r:Y)()});return w.current=!0,function(){E.current=!0,n(),i(),o()}}},[h,Y]),j(function(){var r=null,t=function(){return f(e,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return Q.current.error||!m.current.refreshWhenHidden&&!m.current.isDocumentVisible()||!m.current.refreshWhenOffline&&!m.current.isOnline()?[3,2]:[4,Y({dedupe:!0})];case 1:e.sent(),e.label=2;case 2:return m.current.refreshInterval&&r&&(r=setTimeout(t,m.current.refreshInterval)),[2]}})})};return m.current.refreshInterval&&(r=setTimeout(t,m.current.refreshInterval)),function(){r&&(clearTimeout(r),r=null)}},[s.refreshInterval,s.refreshWhenHidden,s.refreshWhenOffline,Y]),s.suspense&&void 0===C){if(void 0===H)throw Y({dedupe:!0});throw H}var Z=o(function(e,r){return F(V.current,e,r)},[]),$={revalidate:Y,mutate:Z};return Object.defineProperties($,{data:{get:function(){return U.current.data=!0,C},enumerable:!0},error:{get:function(){return U.current.error=!0,H},enumerable:!0},isValidating:{get:function(){return U.current.isValidating=!0,N},enumerable:!0}}),a(C),$}Object.defineProperty(E.Provider,"default",{value:w});var q=E.Provider;function G(){for(var e=this,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var u=T(r),a=u[0],c=u[1],d=u[2],v=c.initialSize,h=void 0===v?1:v,p=c.revalidateAll,y=void 0!==p&&p,g=c.persistSize,m=void 0!==g&&g,w=s(c,["initialSize","revalidateAll","persistSize"]),O=null;try{O=b.serializeKey(a?a(0,null):null)[0]}catch(e){}var S=n({})[1],E=null;O&&(E="ctx@"+O);var P=null;O&&(P="len@"+O);var V=i(!1),x=o(function(){var e=b.get(P);return void 0!==e?e:h},[P,h]),z=i(x());j(function(){V.current?O&&b.set(P,m?z.current:h):V.current=!0},[O]);var R=i(),I=H(O?["inf",O]:null,function(){return f(e,void 0,void 0,function(){var e,r,t,n,i,o,u,s,f,v,h,p;return l(this,function(l){switch(l.label){case 0:e=b.get(E)||{},r=e.data,t=e.force,n=[],i=x(),o=null,u=0,l.label=1;case 1:return u<i?(s=b.serializeKey(a?a(u,o):null),f=s[0],v=s[1],f?(h=b.get(f),p=y||t||void 0===h||void 0===t&&0===u&&void 0!==R.current||r&&!c.compare(r[u],h),d&&p?null===v?[3,3]:[4,d.apply(void 0,v)]:[3,6]):[3,8]):[3,8];case 2:return h=l.sent(),[3,5];case 3:return[4,d(f)];case 4:h=l.sent(),l.label=5;case 5:b.set(f,h),l.label=6;case 6:n.push(h),o=h,l.label=7;case 7:return++u,[3,1];case 8:return b.delete(E),[2,n]}})})},w);j(function(){R.current=I.data},[I.data]);var D=o(function(e,r){if(void 0===r&&(r=!0),E){if(r&&void 0!==e){var t=R.current;b.set(E,{data:t,force:!1})}else r&&b.set(E,{force:!0});return I.mutate(e,r)}},[E]),K=o(function(e){var r;if(P)return"function"==typeof e?r=e(x()):"number"==typeof e&&(r=e),"number"==typeof r&&(b.set(P,r),z.current=r),S({}),D(function(e){return e})},[P,x,D,S]),k={size:x(),setSize:K,mutate:D};return Object.defineProperties(k,{error:{get:function(){return I.error},enumerable:!0},data:{get:function(){return I.data},enumerable:!0},revalidate:{get:function(){return I.revalidate},enumerable:!0},isValidating:{get:function(){return I.isValidating},enumerable:!0}}),k}export default H;export{q as SWRConfig,b as cache,F as mutate,C as trigger,G as useSWRInfinite};
